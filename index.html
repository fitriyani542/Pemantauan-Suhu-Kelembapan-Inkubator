<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Grafik Suhu & Kelembaban dari ThingSpeak</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f2f2f2;
    }
    h1 {
      text-align: center;
    }
    .chart-container {
      width: 90%;
      max-width: 800px;
      margin: 30px auto;
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
  </style>
</head>
<body>

<h1>Monitoring Suhu & Kelembaban</h1>

<div class="chart-container">
  <h3>Grafik Suhu (°C)</h3>
  <canvas id="suhuChart"></canvas>
</div>

<div class="chart-container">
  <h3>Grafik Kelembaban (%)</h3>
  <canvas id="kelembabanChart"></canvas>
</div>

<script>
  const channelId = "1035657"; // Ganti dengan Channel ID kamu
  const updateInterval = 30000; // 30 detik (30.000 ms)

  let suhuChart, kelembabanChart;

  function fetchAndUpdate() {
    const url = `https://api.thingspeak.com/channels/${channelId}/feeds.json?results=20`;

    fetch(url)
      .then(res => res.json())
      .then(data => {
        const feeds = data.feeds;

        const labels = feeds.map(f => new Date(f.created_at).toLocaleTimeString());
        const suhuData = feeds.map(f => parseFloat(f.field1));
        const kelembabanData = feeds.map(f => parseFloat(f.field2));

        updateChart(suhuChart, labels, suhuData);
        updateChart(kelembabanChart, labels, kelembabanData);
      })
      .catch(err => {
        console.error("Gagal mengambil data:", err);
      });
  }

  function createChart(canvasId, label, color) {
    const ctx = document.getElementById(canvasId).getContext("2d");
    return new Chart(ctx, {
      type: "line",
      data: {
        labels: [],
        datasets: [{
          label: label,
          data: [],
          borderColor: color,
          backgroundColor: color + "33", // transparan
          fill: false,
          tension: 0.3
        }]
      },
      options: {
        responsive: true,
        scales: {
          x: { title: { display: true, text: "Waktu" } },
          y: { title: { display: true, text: label } }
        }
      }
    });
  }

  function updateChart(chart, labels, data) {
    chart.data.labels = labels;
    chart.data.datasets[0].data = data;
    chart.update();
  }

  // Inisialisasi grafik
  suhuChart = createChart("suhuChart", "Suhu (°C)", "rgba(255,99,132,1)");
  kelembabanChart = createChart("kelembabanChart", "Kelembaban (%)", "rgba(54,162,235,1)");

  // Ambil data pertama kali
  fetchAndUpdate();

  // Setiap 30 detik, perbarui grafik
  setInterval(fetchAndUpdate, updateInterval);
</script>

</body>
</html>
